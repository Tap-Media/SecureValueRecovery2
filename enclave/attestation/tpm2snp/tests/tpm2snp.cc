// Copyright 2023 Signal Messenger, LLC
// SPDX-License-Identifier: AGPL-3.0-only

//TESTDEP gtest
//TESTDEP attestation/sev
//TESTDEP attestation/tpm2
//TESTDEP attestation/tpm2snp
//TESTDEP util
//TESTDEP env
//TESTDEP env/test
//TESTDEP context
//TESTDEP minimums
//TESTDEP metrics
//TESTDEP proto
//TESTDEP protobuf-lite
//TESTDEP libsodium
//TESTDEP boringssl
//TESTDEP sha

#include <gtest/gtest.h>
#include "env/env.h"
#include "util/log.h"
#include "util/hex.h"
#include "util/base64.h"
#include "context/context.h"
#include "attestation/tpm2snp/tpm2snp.h"

namespace svr2::attestation::tpm2snp {

class TPM2SNPTest : public ::testing::Test {
 protected:
  static void SetUpTestCase() {
    env::Init(env::SIMULATED);
    CHECK(error::OK == util::B64DecodeInline(&azure_report, util::B64STD));
    auto [snp, err1] = SNPReportBufferFromAzureBuffer(azure_report);
    auto [run, err2] = RuntimeDataBufferFromAzureBuffer(azure_report);
    CHECK(err1 == error::OK && err2 == error::OK);
    snp_report = snp;
    runtime_data = run;
    CHECK(error::OK == util::B64DecodeInline(&akcert_der, util::B64STD));
    CHECK(error::OK == util::B64DecodeInline(&intermediate_der, util::B64STD));
    CHECK(error::OK == util::B64DecodeInline(&vcek_der, util::B64STD));
    CHECK(error::OK == util::B64DecodeInline(&ask_der, util::B64STD));
  }
  static std::string azure_report;
  static std::string snp_report;
  static std::string runtime_data;
  static std::string akcert_der;
  static std::string intermediate_der;
  static std::string vcek_der;
  static std::string ask_der;
  static util::UnixSecs now;
  context::Context ctx;
};

TEST_F(TPM2SNPTest, SNPReportBufferFromAzureBuffer) {
  auto [buf, err] = SNPReportBufferFromAzureBuffer(azure_report);
  EXPECT_EQ(error::OK, err);
  EXPECT_EQ(buf, azure_report.substr(32, 1184));
  auto [buf2, err2] = SNPReportBufferFromAzureBuffer("abc");
  EXPECT_EQ(error::AttestationTPM2SNP_AzureBufferTooSmall, err2);
}

TEST_F(TPM2SNPTest, RuntimeDataBufferFromAzureBuffer) {
  auto [buf, err] = RuntimeDataBufferFromAzureBuffer(azure_report);
  EXPECT_EQ(error::OK, err);
  // This is NOT the entire rest of the buffer; we knock off a bunch of null bytes
  EXPECT_EQ(buf, azure_report.substr(1236, 1110));
  auto [buf2, err2] = SNPReportBufferFromAzureBuffer("abc");
  EXPECT_EQ(error::AttestationTPM2SNP_AzureBufferTooSmall, err2);
}

TEST_F(TPM2SNPTest, VerifyAKCert) {
  TPM2SNPEvidence evidence;
  evidence.set_akcert_der(akcert_der);
  evidence.set_snp_report(snp_report);
  evidence.set_runtime_data(runtime_data);
  TPM2SNPEndorsements endorsements;
  endorsements.set_intermediate_der(intermediate_der);
  endorsements.set_vcek_der(vcek_der);
  endorsements.set_ask_der(ask_der);
  minimums::MinimumValues mins;

  EXPECT_EQ(error::OK, VerifyAKCert(&ctx, evidence, endorsements, now, azure_roots_of_trust, &mins));
}

TEST_F(TPM2SNPTest, AzureRuntimeDataFromCert) {
  auto akcert_start = reinterpret_cast<const uint8_t*>(akcert_der.data());
  bssl::UniquePtr<X509> akcert(d2i_X509(nullptr, &akcert_start, akcert_der.size()));
  ASSERT_TRUE(akcert);
  auto [out, err] = AzureRuntimeDataFromCert(akcert.get());
  ASSERT_EQ(err, error::OK);
  ASSERT_EQ(out, "{\"keys\":[{\"kid\":\"HCLAkPub\",\"kty\":\"RSA\",\"e\":\"AQAB\",\"n\":\"kshJoAAAcz5ArXYwn2J3vK6Ek5gs9fr1dNkSeRbtsZHaG0iQaBXKDkv4P6A0jZ4Ycji59sNbV8PdAT4COHXjg7yjxG7Ct6Jen3fd4F43rGjxPR5BuG5KwpvpYAfGPU-gcnihDEMphQSmAC-YHXou8HQSursoTkr_C3k_cCtU2KNiYl0LvPESMJCL8rldo8jsVxXps8syperoDNpAc_4za7FfeAtJIUt2cMkeB8jyTYliTI7HpyuBqPVfrctBKXfuZ_ErzWXd5MEwxn1e4ujZh0whmI4zUwKWBjBhW-obM3MSGnzD2W5TDRlXqGZ0DIXCwku3QYMU92Ggg_lQlyI6Kw\"}]}");
}

std::string TPM2SNPTest::azure_report = "SENMQQEAAAAqCQAAAgAAAAAAAAAAAAAAAAAAAAAAAAACAAAABQAAAB8AAwAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAAAAAjSAQAAAAAAAAAAAAAAAAAAAEI4cJzLVlNgWpgnGLK3w1PjpJMXwQGCen85CnBYnycDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACaxI/KyKLYiu7/jUJ61PK+DjkXx0ihi99SzDF+f+IDCLRZ1e8aEuDCKUTrOG0XwxUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANWIViCqCUnmoWzALC3QpMdETv34y3eLlD/3n7HQ8pJHs3X8zbcKKbgsrtXr3pEowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIPVeFJD9WaWXEIPSxSV3GvMeTuPL5v/iN0hq3eeyabe//////////////////////////////////////////8DAAAAAAAIcwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmoO0QH7ctUzVuTo16erFwGrX/Kqv6M1DG1+rKC8Tc6cFy9TOm6qz4Dll6aFpCUmzXEAtMKcfM0IGXXf0xgaOsDAAAAAAAIcwQ0AQAENAEAAwAAAAAACHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnLeOqQcnLZlFdVjMx2sLBGTpca188y3sW0vi05BleMy0Mw0F44ih9umZZuSGJ8mcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABw2SpXN/2hblf1UZ66/SvuM2j2JGaLhll1LOW7dyspOkGSLcnOAofL/NodI6v3N9MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGoEAAABAAAAAgAAAAEAAABWBAAAeyJrZXlzIjpbeyJraWQiOiJIQ0xBa1B1YiIsImtleV9vcHMiOlsic2lnbiJdLCJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsIm4iOiJrc2hKb0FBQWN6NUFyWFl3bjJKM3ZLNkVrNWdzOWZyMWROa1NlUmJ0c1pIYUcwaVFhQlhLRGt2NFA2QTBqWjRZY2ppNTlzTmJWOFBkQVQ0Q09IWGpnN3lqeEc3Q3Q2SmVuM2ZkNEY0M3JHanhQUjVCdUc1S3dwdnBZQWZHUFUtZ2NuaWhERU1waFFTbUFDLVlIWG91OEhRU3Vyc29Ua3JfQzNrX2NDdFUyS05pWWwwTHZQRVNNSkNMOHJsZG84anNWeFhwczhzeXBlcm9ETnBBY180emE3RmZlQXRKSVV0MmNNa2VCOGp5VFlsaVRJN0hweXVCcVBWZnJjdEJLWGZ1Wl9FcnpXWGQ1TUV3eG4xZTR1alpoMHdobUk0elV3S1dCakJoVy1vYk0zTVNHbnpEMlc1VERSbFhxR1owRElYQ3drdTNRWU1VOTJHZ2dfbFFseUk2S3cifSx7ImtpZCI6IkhDTEVrUHViIiwia2V5X29wcyI6WyJlbmNyeXB0Il0sImt0eSI6IlJTQSIsImUiOiJBUUFCIiwibiI6InkxVUQ0QUFBaHNEa2lQcExGakdTTjE5WmQ1TUs0UlF4WEk1R0h5Zk9wOGk4SXhxZXVacnFTLTl1TUppNW9MOHpqc3NabTRoOWdBUDdqbXhKalZiTGRuTEdsUll4QjJwSTYwNzIxMkQxNjFXeEYyNzlPNzRBcnJaTWpBUTh6cndXeTExbGJPektHSFZ1bVVwUGhpUHllSFNKWHZCNmJTWHQzQzE3RjhHZ2pqVzZNYko0WTdEbGRDbDB2STBZY2RncF9kOUpDaDlMc2dNOHFvMjNRaUJaWThDRmtBZURZNUtUZHlEaThEemNJV3UyXzZzeUxjNVVBRnNVS3V0ZVJ2N2FKc2pJZnZfLUVtNVVaUmFreUlhWXVaMVlEbUtpQ0FYUGpQUGliUk4wX2VFMzgwd3IyTW1uRXhxYk9PbEZrVWowaEdXUEpiUTJzQ093Y0ZRV3V6cGcydyJ9XSwidm0tY29uZmlndXJhdGlvbiI6eyJjb25zb2xlLWVuYWJsZWQiOnRydWUsInNlY3VyZS1ib290Ijp0cnVlLCJ0cG0tZW5hYmxlZCI6dHJ1ZSwidm1VbmlxdWVJZCI6IkM5MUZBN0Y5LTg2RTEtNDc1OS04NEZCLUI4N0VCOUJEQ0YyNiJ9LCJ1c2VyLWRhdGEiOiIwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCJ9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=";
std::string TPM2SNPTest::akcert_der = "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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==";
std::string TPM2SNPTest::intermediate_der = "MIIFnDCCA4SgAwIBAgITMwAAAALA0XtLj5ecNQAAAAAAAjANBgkqhkiG9w0BAQwFADBpMQswCQYDVQQGEwJVUzEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9uMTowOAYDVQQDEzFBenVyZSBWaXJ0dWFsIFRQTSBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDIzMB4XDTIzMDYwODE3NTMwNFoXDTI1MTEwMzE3NTMwNFowJTEjMCEGA1UEAxMaR2xvYmFsIFZpcnR1YWwgVFBNIENBIC0gMDEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC/NqouHGBovTadw1GLMQYNxWrEciPSh7gE7VxsfbbPCE0SfTO80OF2raLdRYN2gEWE2Dr8+TDUuAb/WBFyczhU1aHFPssg8B3/DT6pTXlDlohLLPWkjYU+OuT1/Ls7RzjQBe2se/MJyPaIJXI6KgCwePw7EcWFChe8aCTUMHYBG0Ju4xNlMTUd/tcu6a53CXn6Nq48umwlaJelRh+i1f0vcwB2CY/v+Rliwb/8DM5Ed9FUHZOKyp5Vnaw9GWloM46sLQT/fdHB0jmugfNZzafkkhQAYiNL3jYNYFZH5/IgUfYJ/yybwnwoxOdV2NV0Q2i+P5Pcb0WNGaJY47aqOj8BAgMBAAGjggF/MIIBezASBgNVHRMBAf8ECDAGAQH/AgEAMA4GA1UdDwEB/wQEAwICBDAXBgNVHSUEEDAOBgVngQUIAQYFZ4EFCAMwHQYDVR0OBBYEFP/2zueowUhpKMuKS/LYgYG1bYCBMB8GA1UdIwQYMBaAFEv+JlqUwfYzw4NIJt3z5bBksqqVMHYGA1UdHwRvMG0wa6BpoGeGZWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY3JsL0F6dXJlJTIwVmlydHVhbCUyMFRQTSUyMFJvb3QlMjBDZXJ0aWZpY2F0ZSUyMEF1dGhvcml0eSUyMDIwMjMuY3JsMIGDBggrBgEFBQcBAQR3MHUwcwYIKwYBBQUHMAKGZ2h0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvQXp1cmUlMjBWaXJ0dWFsJTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAyMy5jcnQwDQYJKoZIhvcNAQEMBQADggIBAEhTwx26W+Xap7zXExbAwnHYtN6kB4dIGXdgQIiQy5OQltsSj2jx7qZ/af5n5OnTBQ+gXM8siVipgaAIdBkbGgOjCb6b6MTe1YpFAH4fQv8eVwTVDziBMD0EKI30h0JbFKLdSdKe48O9Lw+T2b0PBXvMFJOSdZT7meGIkpNxSqmAZ+RNyreLxil9knNjF5ymPT0RcGK52+MwGlElBb/jc+snhr+ZJZ1grjFky9NzjCTiE5SG+6H3YgiHCqfXr0L3NRt/QZ5IgkuGkNPeMvn4JjevFwAhXFxBqJYJ7mY61MJuWTdyhhoUJgzmZo1hS+GNyuMKaKBLreUwtc1y7LRH3YGGed57HbQ9bmyMdhO7x8KZNrBDX2/cRLzrCmpSUldmKMu9G4dpzXpde4pFMObiVFrGRq8/9HMOJwZlQvzhwQp0PUMY/gIU5rf23n1M1M36tM5g5CEzxQUGtVaG9ABTJQ2zijD5wDo840vbznyKt3ihimrUs+LqpPDNXyxbwvibcZidwSdhu0QmUoyYsgSP2Zff5E8ks53h2xQSM3zz2qaWVS1vVqG4zC0EfRnO65ogPPfrtK6ZiFmVHSWP9vPkFcUNYDnYQXW/TArO/JCe2I++GClM7AcDQwWLxcopzskGQdHNM1zMsprRRwYaVpTJH67xeNda6+Y7IOPJYTvyoXHP";
std::string TPM2SNPTest::vcek_der = "MIIFTDCCAvugAwIBAgIBADBGBgkqhkiG9w0BAQowOaAPMA0GCWCGSAFlAwQCAgUAoRwwGgYJKoZIhvcNAQEIMA0GCWCGSAFlAwQCAgUAogMCATCjAwIBATB7MRQwEgYDVQQLDAtFbmdpbmVlcmluZzELMAkGA1UEBhMCVVMxFDASBgNVBAcMC1NhbnRhIENsYXJhMQswCQYDVQQIDAJDQTEfMB0GA1UECgwWQWR2YW5jZWQgTWljcm8gRGV2aWNlczESMBAGA1UEAwwJU0VWLU1pbGFuMB4XDTIyMTEyMzIyNTAzNloXDTI5MTEyMzIyNTAzNlowejEUMBIGA1UECwwLRW5naW5lZXJpbmcxCzAJBgNVBAYTAlVTMRQwEgYDVQQHDAtTYW50YSBDbGFyYTELMAkGA1UECAwCQ0ExHzAdBgNVBAoMFkFkdmFuY2VkIE1pY3JvIERldmljZXMxETAPBgNVBAMMCFNFVi1WQ0VLMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAESyP3EnWqGfCfUFsviLb2tCUIO1zkhOy1VsOaTdPm8PwnXFYS2z4m60zH7gNZqNKDfy2MFQLQPr/zBExyVP9YdqV0jItokuSVfJamphzOQSr7nLJCbn++lvX2TKpuXzvgo4IBFjCCARIwEAYJKwYBBAGceAEBBAMCAQAwFwYJKwYBBAGceAECBAoWCE1pbGFuLUIwMBEGCisGAQQBnHgBAwEEAwIBAzARBgorBgEEAZx4AQMCBAMCAQAwEQYKKwYBBAGceAEDBAQDAgEAMBEGCisGAQQBnHgBAwUEAwIBADARBgorBgEEAZx4AQMGBAMCAQAwEQYKKwYBBAGceAEDBwQDAgEAMBEGCisGAQQBnHgBAwMEAwIBCDARBgorBgEEAZx4AQMIBAMCAXMwTQYJKwYBBAGceAEEBECpqDtEB+3LVM1bk6NenqxcBq1/yqr+jNQxtfqygvE3OnBcvUzpuqs+A5ZemhaQlJs1xALTCnHzNCBl139MYGjrMEYGCSqGSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAICBQChHDAaBgkqhkiG9w0BAQgwDQYJYIZIAWUDBAICBQCiAwIBMKMDAgEBA4ICAQCF8PtipEj+XW8z+pb2yGGeTSDAyfXlXAc5YYVTG4Xw2j/pQdm31W9k/mDCwOR/ZgjrtrMJDClmJ2eD8JNtj/Plyeh+dtbPTffXBAXxfxHDZxGYP4Fhf5gadveT3it6HGFkm9Wyq15dl1wDmnquTu/lF/0ReiaNYCOAh0rhqEZJCzzkmqFSO39wkhdqo2XtuVD86im0yCVE/OU7cOCPRzmHs6zJwvao+VL6/R5kjhe6FjP5O1UZyqooIB7xwo6TBoxuNgPD4Ht4oISPgjKVCp8IIVH09ovzQze1f3cQa0wECPAtkfh/BvdIi67TfRPkOB68mwtny9xAx9+KNmpJw8x8bwi7IRXixOx0+TRMdtqxF2nsBS4AjUpSW0Z8AvYTT6qylDEW8EHXwF6Kz4ZUc40A36gJ4HKjai1zC/OuZyC4kQ5vqsgNUl8HRJWqcHJnn/ihecwf8LboAGzwy8e+wMwAVxU/1CAF6Zj0SN3nHQL5Gq2Fyfc7UjUzDaTJ1y7S8GEfSxIguesVC03WWkV1GnPozTYeoi/Apl+UOve3sM+F/cyJUcqaVnG2d4JaDAFYuFJ6TVIp1X1XDEa/D/Xk13Dy/coDKWj7cciqsa/dddczYJTABj9d7R3q5diybtC/pWqbAG4ud3rPRYbbr04cj8qNgCnqAnFg6wHLzOaqGSzBMQ==";
std::string TPM2SNPTest::ask_der = "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";
util::UnixSecs TPM2SNPTest::now = 1706918250;
std::string TPM2SNPTest::snp_report;
std::string TPM2SNPTest::runtime_data;

}  // namespace svr2::attestation::tpm2snp
